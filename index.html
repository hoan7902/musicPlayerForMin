<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zing Mp3</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music player</title>
    <link rel="icon" href="https://scontent.fsgn8-1.fna.fbcdn.net/v/t39.30808-6/277133898_1675199426163914_5312991589474742682_n.jpg?_nc_cat=111&ccb=1-5&_nc_sid=8bfeb9&_nc_ohc=jqv4JVpxjUgAX__SK_2&_nc_ht=scontent.fsgn8-1.fna&oh=00_AT_6Zqj4g5Gbe2G_Kbjp1p31xwRy2VVsR6ghznlHbfgoQg&oe=62470831" type="image">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" integrity="sha512-HK5fgLBL+xu6dm/Ii3z4xhlSUyZgTT9tuc/hSrtw6uzJOvgRr2a9jyxxT1ely+B+xFAmJKVSTbpM/CuL7qxO8w==" crossorigin="anonymous" />
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="stylesheet" href="assets/css/main.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="player">
    <!-- Dashboard -->
    <div class="dashboard">
        <!-- Header -->
        <header>
        <h4 style="font-size: 15px">Now playing:</h4>
        <h2 style="color: #fff; font-style: italic; font-weight: 400"></h2>
        </header>

        <!-- CD -->
        <div class="cd">
        <div class="cd-thumb" style="background-image: url('')">
        </div>
        </div>

        <!-- Control -->
        <div class="control">
        <div class="btn btn-repeat">
            <i class="fas fa-redo"></i>
        </div>
        <div class="btn btn-prev">
            <i class="fas fa-step-backward"></i>
        </div>
        <div class="btn btn-toggle-play">
            <i class="fas fa-pause icon-pause"></i>
            <i class="fas fa-play icon-play"></i>
        </div>
        <div class="btn btn-next">
            <i class="fas fa-step-forward"></i>
        </div>
        <div class="btn btn-random">
            <i class="fas fa-random"></i>
        </div>
        </div>

        <input id="progress" class="progress" type="range" value="0" step="1" min="0" max="100">

        <audio id="audio" src=""></audio>
    </div>

    <!-- Playlist -->
    <div class="playlist">
    </div>
    </div>

    <!-- Design from: https://static.collectui.com/shots/3671744/musicloud-revolutionary-app-for-music-streaming-large -->
    <script>
        const $ = document.querySelector.bind(document)
        const $$ = document.querySelectorAll.bind(document)
        var isRandom = false
        var isPlaying = false
        var isRepeat = false

        const cd = $('.cd')
        const heading = $('header h2')
        const audio = $('#audio')
        const cdThumb = $('.cd-thumb')
        const playBtn = $('.btn-toggle-play')
        const nextBtn = $('.btn-next')
        const preBtn = $('.btn-prev')
        const randomBtn = $('.btn-random')
        const repeatBtn = $('.btn-repeat')
        const player = $('.player')
        const progress = $('#progress')
        const playlist = $('.playlist')
        const app = {
            currIndex: 0,
            songs: [
                {
                    name: 'Anh mơ',
                    singer: 'Anh Khang',
                    path: 'assets/music/AnhMo-AnhKhang_3h79s.mp3',
                    image: 'https://scontent.fsgn4-1.fna.fbcdn.net/v/t39.30808-6/277147075_1675199482830575_5751246041751148571_n.jpg?_nc_cat=101&ccb=1-5&_nc_sid=8bfeb9&_nc_ohc=uuWSTbNptWwAX_eNYwh&tn=F92FjFIvQ_9g_ajx&_nc_ht=scontent.fsgn4-1.fna&oh=00_AT9wmehL9ZOHskaXMA2Tmo7PMJ4ohdeB2eyGjIZx51RJjw&oe=62484CA0'
                },
                {
                    name: 'Bình yên nơi đâu',
                    singer: 'Sơn tùng M-TP',
                    path: 'assets/music/BinhYenNoiDau-M-TP_452gz.mp3',
                    image: 'https://scontent.fsgn13-2.fna.fbcdn.net/v/t39.30808-6/265469274_1605340399816484_3219726314760706201_n.jpg?_nc_cat=108&ccb=1-5&_nc_sid=8bfeb9&_nc_ohc=tPStrD1EhMYAX9u--Ft&_nc_ht=scontent.fsgn13-2.fna&oh=00_AT-pX83-OhGPuZYNWJrMKIMAFU51JsaT17T7GYfGn7GUMw&oe=6246B49B'
                },
                {
                    name:'Don\'t break my heart',
                    singer: 'Binz',
                    path: 'assets/music/Don_t Break My Heart - Binz_ Touliver.mp3',
                    image: 'https://scontent.fsgn4-1.fna.fbcdn.net/v/t1.6435-9/195541086_1481342122216313_856837148052903031_n.jpg?_nc_cat=103&ccb=1-5&_nc_sid=8bfeb9&_nc_ohc=HMr9iKA81ZQAX9UPggL&_nc_ht=scontent.fsgn4-1.fna&oh=00_AT84v1GE9XyliKACAJ9J__1hmozhBPgF97TRGo_RcWk9PQ&oe=6269BDAD'
                },
                {
                    name: 'Ngày xưa em đến',
                    singer: 'Anh Khang',
                    path: 'assets/music/NgayXuaEmDen-AnhKhang_4dmq4.mp3',
                    image: 'https://scontent.fsgn3-1.fna.fbcdn.net/v/t1.6435-9/168479275_1433869756963550_8804424515934741534_n.jpg?_nc_cat=107&ccb=1-5&_nc_sid=8bfeb9&_nc_ohc=ZTrlB6tR-gYAX8PIMc1&tn=F92FjFIvQ_9g_ajx&_nc_ht=scontent.fsgn3-1.fna&oh=00_AT-UlN13bKK86eMPabJC9L3gGyTTrlexTM9uOT4MciNxXw&oe=626A096E'
                },
                {
                    name: 'Người ấy',
                    singer: 'Trịnh Thăng Bình',
                    path: 'assets/music/NguoiAy-TrinhThangBinh-4086656.mp3',
                    image: 'https://scontent.fsgn13-2.fna.fbcdn.net/v/t1.6435-9/154194040_1407637992920060_532559634229196345_n.jpg?stp=dst-jpg_s1080x2048&_nc_cat=109&ccb=1-5&_nc_sid=8bfeb9&_nc_ohc=WfIsNrV1lXIAX-HmOh-&_nc_ht=scontent.fsgn13-2.fna&oh=00_AT9w7MVxECfvXncc77kqkZ-UJND4hDyD4f6mHdMThDBClA&oe=626671F2'
                },
                {
                    name: 'Sau tất cả',
                    singer: 'Erik',
                    path: 'assets/music/SauTatCa-MONSTARERIKST319-4301357.mp3',
                    image: 'https://scontent.fsgn8-1.fna.fbcdn.net/v/t1.6435-9/150976148_1402968330053693_2456061317604218028_n.jpg?stp=dst-jpg_p843x403&_nc_cat=102&ccb=1-5&_nc_sid=8bfeb9&_nc_ohc=hJ7R7P7ZXBUAX9iOMMf&_nc_ht=scontent.fsgn8-1.fna&oh=00_AT-CFNCnNDXgjU9YUMEh8iaWIc7RWZFRu645uiED4Lv11A&oe=6267F504'
                },
                {
                    name: 'Hai mươi',
                    singer: 'Mỹ Tâm',
                    path: 'assets/music/TaiNhacHay.Biz - Hai Mươi.mp3',
                    image: 'https://scontent.fsgn3-1.fna.fbcdn.net/v/t1.6435-9/140371531_1381059575577902_3604671538113169024_n.jpg?stp=dst-jpg_s1080x2048&_nc_cat=107&ccb=1-5&_nc_sid=8bfeb9&_nc_ohc=nMbiVXcN72wAX_laIBq&_nc_ht=scontent.fsgn3-1.fna&oh=00_AT_VNiTWwejG9NYvt4UKPolvoPMatZDz3F48dhfUvCTaOw&oe=626710E5'
                },
                {
                    name: 'Anh yêu nhiều lắm',
                    singer: 'Đức Phúc',
                    path: 'assets/music/ Anh Yêu Em Nhiều Lắm  Đức Phúc  Eye Contact LIVE  4th Project.mp3',
                    image: 'https://scontent.fsgn13-2.fna.fbcdn.net/v/t1.6435-9/128542480_1348461085504418_1768643515213876566_n.jpg?_nc_cat=106&ccb=1-5&_nc_sid=8bfeb9&_nc_ohc=WDxAvE6bfbUAX9g43KP&_nc_oc=AQkj2kU7CjFo1YCDMKuILP_JWcnVL9--xM32CUofVEIr-I6MQwdgzlEDVR6extiSWtc&_nc_ht=scontent.fsgn13-2.fna&oh=00_AT_OZsVSnHmKT6TklAhzf5wj1xRis9Ap_1AKQnbQEoZNNQ&oe=62688A4D'
                },
                {
                    name: 'Dear future husband',
                    singer: 'Meghan Trainor',
                    path: 'assets/music/Dear Future Husbandlyrics.mp3',
                    image: 'https://scontent.fsgn13-2.fna.fbcdn.net/v/t1.6435-9/109685051_1230585263958668_1012960604166896290_n.jpg?stp=dst-jpg_s1080x2048&_nc_cat=109&ccb=1-5&_nc_sid=8bfeb9&_nc_ohc=HanWglTS-TwAX9FhNmE&tn=F92FjFIvQ_9g_ajx&_nc_ht=scontent.fsgn13-2.fna&oh=00_AT9fL9SxX-hShNsyh78bF24Ar5f3iylaheh8DNxea57IQQ&oe=6266ECBB'
                },
                {
                    name: 'I\'m gonna lose you',
                    singer: 'Meghan Trainor',
                    path: 'assets/music/Im Gonna Lose You Official Video ft John Legend.mp3',
                    image: 'https://scontent.fsgn4-1.fna.fbcdn.net/v/t1.6435-9/37728322_691441794539687_3779600056890425344_n.jpg?_nc_cat=101&ccb=1-5&_nc_sid=8bfeb9&_nc_ohc=ssQYb8wmsfkAX9wwAhw&_nc_ht=scontent.fsgn4-1.fna&oh=00_AT8AFALP2fSFFm7G3ZEDDbc75ZClUJpg7Ma3Vd04h_8Big&oe=626980FF'
                },
                {
                    name: 'Mùa thu cho em',
                    singer: 'Trinh',
                    path: 'assets/music/Mùa thu cho em.mp3',
                    image: '\https://scontent.fsgn4-1.fna.fbcdn.net/v/t1.6435-9/119422376_1279281702422357_8861280464028376742_n.jpg?_nc_cat=101&ccb=1-5&_nc_sid=8bfeb9&_nc_ohc=dFGJHxPKbnAAX-BX2Ud&_nc_ht=scontent.fsgn4-1.fna&oh=00_AT9ciBwWSFy2xTumjmX1bt5_GqvnFS1lAac3XSUGHXKgNw&oe=6269DC45'
                },
                {
                    name: 'Mùa đông của anh',
                    singer: 'Mỹ Tâm',
                    path: 'assets/music/Mỹ Tâm  Mùa Đông Của Anh   Special Present.mp3',
                    image: 'https://scontent.fsgn4-1.fna.fbcdn.net/v/t1.6435-9/51840047_837621786588353_2570953649425481728_n.jpg?_nc_cat=103&ccb=1-5&_nc_sid=8bfeb9&_nc_ohc=uQNiJ3LVvt8AX8_VSbx&_nc_ht=scontent.fsgn4-1.fna&oh=00_AT8i-zAIR1GEyfnL2gq-oIpeI9YztGFA2Bw-rH2FmpxDxw&oe=6266CF6B'
                },
                {
                    name: 'Ước gì',
                    singer: 'Mỹ Tâm',
                    path: 'assets/music/Mỹ Tâm  Ước Gì I WISH MV.mp3',
                    image: 'https://scontent.fsgn4-1.fna.fbcdn.net/v/t1.6435-9/119422376_1279281702422357_8861280464028376742_n.jpg?_nc_cat=101&ccb=1-5&_nc_sid=8bfeb9&_nc_ohc=dFGJHxPKbnAAX-BX2Ud&_nc_ht=scontent.fsgn4-1.fna&oh=00_AT9ciBwWSFy2xTumjmX1bt5_GqvnFS1lAac3XSUGHXKgNw&oe=6269DC45'
                },
                {
                    name: 'Tình yêu chậm trễ',
                    singer: 'Monstar',
                    path: 'assets/music/TÌNH YÊU CHẬM TRỄ  Official Music Video.mp3',
                    image: 'https://scontent.fsgn13-2.fna.fbcdn.net/v/t1.18169-9/21314520_514838632200005_2315071833975255325_n.jpg?_nc_cat=109&ccb=1-5&_nc_sid=8bfeb9&_nc_ohc=9BAU5naUYp4AX9MXCYg&tn=F92FjFIvQ_9g_ajx&_nc_ht=scontent.fsgn13-2.fna&oh=00_AT_wG1rOAWyqfwiaGJ7-TfcJmOpBFO0ZRyCxFIo-teHt-g&oe=62681A6D'
                },
            ],
            renderMusic: function(){
                var htmls = this.songs.map(function(song, index){
                    return `
                    <div class="song ${app.currIndex === index ? 'active' : ''}" data-index="${index}"=>
                    <div class="thumb" style="background-image: url('${song.image}');background-size: 100% 100%;">
                    </div>
                    <div class="body">
                        <h3 class="title">${song.name}</h3>
                        <p class="author">${song.singer}</p>
                    </div>
                    <div class="option">
                        <i class="fas fa-ellipsis-h"></i>
                    </div>
                    </div>
                    `
                })
                playlist.innerHTML = htmls.join('')
            },
            defineProperties: function() {
                Object.defineProperty(this, 'currSong', {
                    get: function() {
                        return this.songs[this.currIndex]
                    }
                })
            },
            handleEvents: function() { 
                // Xử lí để phóng to thu nhỏ
                const cdWidth = cd.offsetWidth
                document.onscroll = function() {
                    const scrollTop = window.scrollY
                    const newCdWidtd = cdWidth - scrollTop
                    cd.style.width = newCdWidtd > 0 ? newCdWidtd + 'px' : 0
                    cd.style.opacity = newCdWidtd / cdWidth
                }
                //Quay đĩa not quay tay
                const controlCd = cdThumb.animate([
                    { transform: 'rotate(360deg)'}, 
                ],
                {
                    duration: 10000,
                    iterations: Infinity,
                }) 
                controlCd.pause()
                // Xử lí để phát audio
                playBtn.onclick = function() {
                    if (!app.isPlaying){
                        audio.play()
                    }
                    else {
                        audio.pause()
                    }
                }

                // Click Khi song đang play
                audio.onplay = function() {
                    controlCd.play()
                    app.isPlaying = true
                    player.classList.add('playing')
                    app.renderMusic()
                }
                // Click Khi song chưa play
                audio.onpause = function() {
                    controlCd.pause()
                    app.isPlaying = false
                    player.classList.remove('playing')
                }

                //khi bài hát thay đổi
                audio.ontimeupdate = function() {
                    if (audio.duration) {
                        var progressPercent = audio.currentTime / audio.duration * 100
                        progress.value = progressPercent
                    }
                }
                // Khi tua    
                progress.onchange = function(e) {
                    const seekTime = e.target.value * audio.duration / 100
                    audio.currentTime = seekTime
                }
                // click next nhạc
                nextBtn.onclick = function() {
                    if (isRepeat) {
                        audio.currentTime = 0
                        audio.play()
                    }
                    else if (isRandom) {
                        app.randomSong()
                        audio.play()
                    }
                    else {
                        app.nextSong()
                        audio.play()
                    }
                    app.renderMusic()
                    app.scrollToActiveSong()
                }
                // click pre nhạc
                preBtn.onclick = function() {
                    if (isRepeat) {
                        audio.currentTime = 0
                        audio.play()
                    }
                    else if (isRandom) {
                        app.randomSong()
                        audio.play()
                    }
                    else {
                        app.preSong()
                        audio.play()
                    }
                    app.renderMusic()
                    app.scrollToActiveSong()
                }
                // click random nhạc
                randomBtn.onclick = function(e) {
                    isRandom = !isRandom
                    this.classList.toggle('active')
                    if (isRepeat && isRandom) {
                        isRepeat = false
                        repeatBtn.classList.toggle('active')
                    }
                }
                // next khi hết bài 
                audio.onended = function() {
                    if (isRepeat) {
                        audio.play()
                    }
                    else if (isRandom) {
                        app.randomSong()
                        audio.play()
                    }
                    else {
                        app.nextSong()
                        audio.play()
                    }
                }
                // click repeat
                repeatBtn.onclick = function() {
                    isRepeat = !isRepeat
                    this.classList.toggle('active')
                    if (isRepeat && isRandom) {
                        isRandom = false
                        randomBtn.classList.toggle('active')
                    }
                }

                playlist.onclick = function(e) {
                    var nodeSongNotAct = e.target.closest('.song:not(.active)')
                    if (nodeSongNotAct || !e.target.closest('.option')) {
                        if (nodeSongNotAct) {
                            app.currIndex = Number(nodeSongNotAct.getAttribute('data-index'))
                            app.loadCurrSong()
                            audio.play()
                            app.scrollToActiveSong()
                        }
                    }
                }
            },
            getCurrSong: function() {
                return this.songs[this.currIndex]
            },
            loadCurrSong: function() {
                heading.textContent = this.currSong.name
                cdThumb.style.backgroundImage = `url('${this.currSong.image}')`
                cdThumb.style.backgroundSize = `100% 100%`

                audio.src = this.currSong.path
            },
            nextSong: function() {
                this.currIndex++
                if (this.currIndex == this.songs.length) {
                    this.currIndex = 0
                }
                app.loadCurrSong()
            },
            preSong: function() {
                this.currIndex--
                if (this.currIndex < 0) {
                    this.currIndex = this.songs.length - 1
                }
                app.loadCurrSong()
            },
            randomSong: function() {
                var randomIndex = Math.floor(Math.random() * (this.songs.length))
                while(randomIndex == app.currIndex){
                    randomIndex = Math.floor(Math.random() * (this.songs.length))
                }
                this.currIndex = randomIndex
                this.loadCurrSong()
            },
            clickSong: function() {
                this.songs.forEach(function(song, index) {
                    song.onclick = function() {
                        console.log('m ngu vcl')
                        app.currIndex = index
                        app.loadCurrSong()
                    }
                })
            },
            scrollToActiveSong: function() {
                setTimeout(function() {
                    $('.song.active').scrollIntoView({
                        behavior: 'smooth',
                        block: 'end'
                    })
                }, 300)
            }
            ,
            start: function() {
                //thềm các thuộc tính
                this.defineProperties()
                //xử lí sự kiện DOM
                this.handleEvents()
                //Load bài hát
                this.loadCurrSong()
                // render ra giao diện
                this.renderMusic()
                //click nhạc
                this.clickSong()
                // kéo nhạc lên
            }
        }
        app.start()
    </script>
</body>
</html>